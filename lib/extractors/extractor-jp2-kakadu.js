// Generated by CoffeeScript 1.10.0
(function() {
  var ExtractorJp2, ExtractorJp2Kakadu, tempfile,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  tempfile = require('tempfile');

  ExtractorJp2 = require('./extractor-jp2').ExtractorJp2;

  ExtractorJp2Kakadu = (function(superClass) {
    extend(ExtractorJp2Kakadu, superClass);

    function ExtractorJp2Kakadu() {
      return ExtractorJp2Kakadu.__super__.constructor.apply(this, arguments);
    }

    ExtractorJp2Kakadu.prototype.set_temp_out_image = function() {
      return this.temp_out_image = tempfile('.tif');
    };

    ExtractorJp2Kakadu.prototype.extract_cmd = function() {
      var cmd, height, height_pct, left, left_pct, reduction, ref, ref1, top, top_pct, width, width_pct;
      if (this.params.region === 'full') {
        ref = [0, 0, this.info.height, this.info.width], top = ref[0], left = ref[1], height = ref[2], width = ref[3];
      } else {
        ref1 = [this.params.region.y, this.params.region.x, this.params.region.h, this.params.region.w], top = ref1[0], left = ref1[1], height = ref1[2], width = ref1[3];
      }
      top_pct = top / this.info.height;
      left_pct = left / this.info.width;
      height_pct = height / this.info.height;
      width_pct = width / this.info.width;
      cmd = "kdu_expand -i " + this.path + " -o " + this.temp_out_image + " -region '{" + top_pct + "," + left_pct + "},{" + height_pct + "," + width_pct + "}'";
      reduction = this.params.size === 'full' ? 0 : this.pick_reduction();
      return cmd + (" -reduce " + reduction);
    };

    return ExtractorJp2Kakadu;

  })(ExtractorJp2);

  exports.ExtractorJp2Kakadu = ExtractorJp2Kakadu;

}).call(this);
