// Generated by CoffeeScript 1.10.0
(function() {
  var IIIFImageExtractorJP2Kakadu, tempfile;

  tempfile = require('tempfile');

  IIIFImageExtractorJP2Kakadu = (function() {
    function IIIFImageExtractorJP2Kakadu(options) {
      this.options = options;
      console.log(this.options);
      this.path = this.options.path;
      this.info = this.options.info;
      this.params = this.options.params;
      this.temp_bmp = tempfile('.bmp');
    }

    IIIFImageExtractorJP2Kakadu.prototype.extract = function(cb) {
      console.log(this.kdu_expand_cmd());
      return cb();
    };

    IIIFImageExtractorJP2Kakadu.prototype.kdu_expand_cmd = function() {
      var height, left, reduction, ref, ref1, top, width;
      if (this.params.region === 'full') {
        ref = [0, 0, this.info.height, this.info.width], top = ref[0], left = ref[1], height = ref[2], width = ref[3];
      } else {
        ref1 = [this.params.region.y, this.params.region.x, this.params.region.h, this.params.region.w], top = ref1[0], left = ref1[1], height = ref1[2], width = ref1[3];
      }
      reduction = this.pick_reduction();
      return "kdu_expand -i " + this.path + " -o " + this.temp_bmp + " -region '{" + top + "," + left + "},{" + height + "," + width + "}' -reduce " + reduction;
    };

    IIIFImageExtractorJP2Kakadu.prototype.pick_reduction = function() {
      var reduction_factor;
      reduction_factor = (this.params.region.w / this.params.size.w) - 1;
      switch (false) {
        case !(reduction_factor >= 12):
          return 6;
        case !(reduction_factor >= 10):
          return 5;
        case !(reduction_factor >= 8):
          return 4;
        case !(reduction_factor >= 6):
          return 3;
        case !(reduction_factor >= 4):
          return 2;
        case !(reduction_factor >= 2):
          return 1;
        default:
          return 0;
      }
    };

    return IIIFImageExtractorJP2Kakadu;

  })();

  exports.IIIFImageExtractorJP2Kakadu = IIIFImageExtractorJP2Kakadu;

}).call(this);
